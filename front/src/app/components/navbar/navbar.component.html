<header role="banner">
  <nav class="navbar" role="navigation" aria-label="Navigation principale de Blob">
    <div class="navbar__links">
      <div class="logo-container">
        <a href="/" aria-label="Accueil Blob - Retour Ã  la page d'accueil" class="logo" [style.color]="randomColor">
          <svg width="192" height="45" viewBox="0 0 192 45" fill="none" xmlns="http://www.w3.org/2000/svg" aria-labelledby="logo-title" role="img">
            <title id="logo-title">Blob - Logo de la plateforme de quiz interactifs</title>
            <g clip-path="url(#clip0_2519_1304)">
              <path d="M41.1744 25.8047C39.288 24.0413 36.6 23.0985 33.1176 22.9713V21.6494C36.348 21.1888 38.784 20.0756 40.4208 18.3147C42.0576 16.5513 42.876 14.1402 42.876 11.0766C42.876 9.02053 42.288 7.2284 41.112 5.69537C39.936 4.16474 38.0688 2.95799 35.508 2.07752C32.9496 1.19465 29.5704 0.755615 25.3728 0.755615H0V44.1818H27.324C32.9496 44.1818 37.1352 43.2366 39.8856 41.3485C42.6336 39.4604 44.0088 36.651 44.0088 32.9156C44.0088 29.9359 43.0656 27.5656 41.1744 25.8047ZM22.4448 29.768C21.9192 30.3558 21.1752 30.6485 20.2104 30.6485H19.5168V24.2932H20.2104C21.132 24.2932 21.8664 24.5667 22.4136 25.1113C22.9584 25.6583 23.232 26.4548 23.232 27.5032C23.232 28.4269 22.968 29.1826 22.4448 29.768ZM22.4448 20.2028C21.9192 20.7905 21.1752 21.0832 20.2104 21.0832H19.5168V14.7256H20.2104C21.132 14.7256 21.8664 14.9991 22.4136 15.5461C22.9584 16.0907 23.232 16.8872 23.232 17.9356C23.232 18.8593 22.968 19.615 22.4448 20.2028Z" fill="currentColor"/>
              <path d="M65.7409 28.2589V0.755615H46.2241V44.1818H76.6345V28.2589H65.7409Z" fill="currentColor"/>
              <path d="M166.968 25.8047C165.079 24.0413 162.391 23.0985 158.909 22.9713V21.6494C162.139 21.1888 164.575 20.0756 166.212 18.3147C167.849 16.5513 168.667 14.1402 168.667 11.0766C168.667 9.02053 168.079 7.2284 166.905 5.69537C165.729 4.16474 163.86 2.95799 161.301 2.07752C158.741 1.19465 155.361 0.755615 151.164 0.755615H125.791V44.1818H153.115C158.741 44.1818 162.926 43.2366 165.677 41.3485C168.425 39.4604 169.8 36.651 169.8 32.9156C169.8 29.9359 168.857 27.5656 166.968 25.8047ZM148.236 29.768C147.71 30.3558 146.966 30.6485 146.001 30.6485H145.31V24.2932H146.001C146.925 24.2932 147.66 24.5667 148.205 25.1113C148.749 25.6583 149.023 26.4548 149.023 27.5032C149.023 28.4269 148.761 29.1826 148.236 29.768ZM148.236 20.2028C147.71 20.7905 146.966 21.0832 146.001 21.0832H145.31V14.7256H146.001C146.925 14.7256 147.66 14.9991 148.205 15.5461C148.749 16.0907 149.023 16.8872 149.023 17.9356C149.023 18.8593 148.761 19.615 148.236 20.2028Z" fill="currentColor"/>
              <path d="M189.168 29.4849C187.277 27.9543 184.822 27.189 181.8 27.189C178.527 27.189 176.009 27.9975 174.245 29.6121C172.483 31.2267 171.6 33.3787 171.6 36.0633C171.6 38.9158 172.546 41.1182 174.434 42.6704C176.323 44.2226 178.779 44.9999 181.8 44.9999C185.074 44.9999 187.594 44.1818 189.355 42.5456C191.119 40.9094 192 38.7479 192 36.0633C192 33.2083 191.055 31.0179 189.168 29.4849Z" fill="currentColor"/>
              <path d="M96.7487 19.4567C97.9727 21.0305 97.6871 23.2977 96.1127 24.5212C94.5383 25.7447 92.2703 25.4593 91.0463 23.8854C89.8247 22.3116 90.1079 20.0445 91.6823 18.8209C93.2567 17.5998 95.5247 17.8829 96.7487 19.4567Z" fill="currentColor"/>
              <path d="M100.392 0C87.5138 0 77.0762 10.0307 77.0762 22.4052C77.0762 34.7798 87.5138 44.8105 100.392 44.8105C113.271 44.8105 123.708 34.7798 123.708 22.4052C123.708 10.0307 113.271 0 100.392 0ZM96.881 28.7485C93.8906 31.0684 89.585 30.5286 87.2618 27.5417C84.941 24.5524 85.481 20.2484 88.469 17.9261C91.4594 15.6038 95.765 16.146 98.0882 19.1329C100.409 22.1221 99.869 26.4261 96.881 28.7485ZM109.723 29.9744C106.056 30.9125 102.322 28.7029 101.383 25.0371C100.443 21.3712 102.655 17.6382 106.323 16.7002C109.99 15.7597 113.724 17.9717 114.663 21.6375C115.601 25.3034 113.391 29.0364 109.723 29.9744ZM108.912 18.8018C106.98 19.296 105.816 21.2609 106.311 23.1921C106.807 25.1234 108.773 26.287 110.705 25.7928C112.637 25.2986 113.801 23.3313 113.307 21.4C112.812 19.4711 110.844 18.3052 108.912 18.8018Z" fill="currentColor"/>
              <path d="M96.1127 24.5212C94.5383 25.7447 92.2703 25.4593 91.0463 23.8854C89.8247 22.3116 90.1079 20.0445 91.6823 18.8209C93.2567 17.5998 95.5247 17.8829 96.7487 19.4567C97.9727 21.0305 97.6871 23.2977 96.1127 24.5212Z" fill="white"/>
              <path d="M96.1127 24.5212C94.5383 25.7447 92.2703 25.4593 91.0463 23.8854C89.8247 22.3116 90.1079 20.0445 91.6823 18.8209C93.2567 17.5998 95.5247 17.8829 96.7487 19.4567C97.9727 21.0305 97.6871 23.2977 96.1127 24.5212Z" fill="#0B0C1E"/>
              <path d="M110.705 25.7927C108.773 26.2869 106.807 25.1233 106.31 23.1921C105.816 21.2608 106.98 19.2959 108.912 18.8017C110.844 18.3051 112.812 19.4711 113.306 21.3999C113.801 23.3312 112.637 25.2985 110.705 25.7927Z" fill="white"/>
              <path d="M110.705 25.7927C108.773 26.2869 106.807 25.1233 106.31 23.1921C105.816 21.2608 106.98 19.2959 108.912 18.8017C110.844 18.3051 112.812 19.4711 113.306 21.3999C113.801 23.3312 112.637 25.2985 110.705 25.7927Z" fill="#0B0C1E"/>
            </g>
            <defs>
              <clipPath id="clip0_2519_1304">
                <rect width="192" height="45" fill="white"/>
              </clipPath>
            </defs>
          </svg>
        </a>
      </div>
      
      <div class="links-container">
        <ul class="nav-list" role="menubar">
          <li class="nav-item" role="none"><a routerLink="/quiz" role="menuitem" aria-label="Voir tous les quiz disponibles">Quiz</a></li>
          <li class="nav-item" role="none" *ngIf="!(isGuest$ | async)"><a routerLink="/classement" role="menuitem" aria-label="Voir le classement des joueurs">Classement</a></li>
          <li class="nav-item" role="none" *ngIf="!(isGuest$ | async)">
            <a routerLink="/creation-quiz" role="menuitem" aria-label="CrÃ©er un nouveau quiz personnalisÃ©" *hasPermission="'CREATE_QUIZ'">CrÃ©er un quiz</a>
          </li>
          <li class="nav-item dropdown" role="none" *ngIf="!(isGuest$ | async)"
              (mouseenter)="showGestionDropdown = true"
              (mouseleave)="showGestionDropdown = false"
              (keydown.enter)="showGestionDropdown = !showGestionDropdown"
              (keydown.escape)="showGestionDropdown = false">
            <a href="#" class="dropdown-toggle" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-label="Menu de gestion de la plateforme">
              Gestion
              <span class="dropdown-arrow" aria-hidden="true">â–¼</span>
            </a>
            <ul class="dropdown-menu" [class.show]="showGestionDropdown" role="menu" aria-label="Sous-menu de gestion">
              <li role="none" *hasPermission="'MANAGE_USERS'"><a routerLink="/gestion-utilisateur" (click)="showGestionDropdown = false" role="menuitem" aria-label="GÃ©rer les utilisateurs de la plateforme">Utilisateurs</a></li>
              <li role="none" *ngIf="isAdmin$ | async"><a routerLink="/gestion-entreprise" (click)="showGestionDropdown = false" role="menuitem" aria-label="GÃ©rer les entreprises partenaires">Entreprises</a></li>
              <li role="none" *hasPermission="'CREATE_QUIZ'"><a routerLink="/gestion-quiz" (click)="showGestionDropdown = false" role="menuitem" aria-label="GÃ©rer les quiz de la plateforme">Quiz</a></li>
              <li role="none" *ngIf="(userCompanyId$ | async)">
                <a [routerLink]="'/company/' + (userCompanyId$ | async)" (click)="showGestionDropdown = false" role="menuitem" aria-label="Voir les dÃ©tails de mon entreprise" *hasPermission="'VIEW_RESULTS'">Mon Entreprise</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <div class="profil-container">
        <div class="progress-container">
          <p id="user-name" aria-label="Nom de l'utilisateur connectÃ©">{{ userName$ | async }}</p>
          <div class="progress-bar-container" role="progressbar" aria-labelledby="user-name" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" [style.width.%]="65"></div>
          </div>
        </div>
        <div class="avatar">
          <img [src]="userAvatar$ | async" alt="Avatar de l'utilisateur {{ userName$ | async }}" aria-labelledby="user-name" />
        </div>

        <div class="profile-dropdown"
             (mouseenter)="showProfileDropdown = true"
             (mouseleave)="showProfileDropdown = false"
             (keydown.enter)="showProfileDropdown = !showProfileDropdown"
             (keydown.escape)="showProfileDropdown = false">
          <div class="chevron-down" aria-hidden="true">â–¼</div>
          <ul class="profile-dropdown-menu" [class.show]="showProfileDropdown" role="menu" aria-label="Menu du profil utilisateur">
            <li role="none" *ngIf="!(isGuest$ | async)"><a routerLink="/profil" (click)="showProfileDropdown = false" role="menuitem" aria-label="Voir mon profil utilisateur">
              <span class="icon" aria-hidden="true">ðŸ‘¤</span>
              Voir le profil
            </a></li>
            <li role="none" *ngIf="isGuest$ | async"><a routerLink="/connexion" (click)="showProfileDropdown = false" role="menuitem" aria-label="Se connecter Ã  la plateforme">
              <span class="icon" aria-hidden="true">ðŸ”‘</span>
              Se connecter
            </a></li>
            <li role="none" *ngIf="!(isGuest$ | async)"><a href="#" (click)="logout(); showProfileDropdown = false" role="menuitem" aria-label="Se dÃ©connecter de la plateforme">
              <span class="icon" aria-hidden="true">ðŸšª</span>
              Se dÃ©connecter
            </a></li>
          </ul>
        </div>
      </div>
    </div>
    
    <button
      type="button"
      class="navbar__toggle"
      (click)="toggle()"
      aria-label="Ouvrir le menu de navigation mobile"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span aria-hidden="true">â˜°</span> Menu
    </button>
  </nav>
</header>

<div class="mobile-drawer" *ngIf="open()" id="mobile-menu" role="navigation" aria-label="Menu mobile">
  <nav class="mobile-menu">
    <div class="mobile-gestion" *ngIf="!(isGuest$ | async)">
      <p class="mobile-section-title" id="mobile-gestion-title">Gestion</p>
      <a routerLink="/gestion-utilisateur" (click)="close()" *hasPermission="'MANAGE_USERS'" aria-labelledby="mobile-gestion-title">Utilisateurs</a>
      <a routerLink="/gestion-entreprise" (click)="close()" *ngIf="isAdmin$ | async" aria-labelledby="mobile-gestion-title">Entreprises</a>
      <a routerLink="/gestion-quiz" (click)="close()" *hasPermission="'CREATE_QUIZ'" aria-labelledby="mobile-gestion-title">Quiz</a>
      <ng-container *ngIf="(userCompanyId$ | async)">
        <a [routerLink]="'/company/' + (userCompanyId$ | async)" (click)="close()" *hasPermission="'VIEW_RESULTS'" aria-labelledby="mobile-gestion-title">Mon Entreprise</a>
      </ng-container>
    </div>
  </nav>
</div>
