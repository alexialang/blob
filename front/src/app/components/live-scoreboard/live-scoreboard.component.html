<div class="live-scoreboard" [class.collapsed]="!showRanking">
  <div class="scoreboard-header">
    <h3 class="scoreboard-title">
      <tui-icon icon="@tui.trophy" class="trophy-icon"></tui-icon>
      Classement en direct
    </h3>
    <div class="question-progress">Question {{ currentQuestionIndex }}/{{ totalQuestions }}</div>
  </div>

  <div class="players-list">
    <div
      *ngFor="let player of players; let i = index"
      class="player-row"
      [class.current-user]="player.isCurrentUser"
      [class.top-3]="i < 3"
      [class.rank-1]="i === 0"
      [class.rank-2]="i === 1"
      [class.rank-3]="i === 2"
    >
      <div class="player-avatar">
        <img
          [src]="getAvatarPath(player)"
          [alt]="player.username + ' avatar'"
          class="blob-avatar"
          width="40"
          height="40"
          [class.rank-changed]="hasRankChanged(player)"
          [class.rank-up]="getRankChange(player) === 'up'"
          [class.rank-down]="getRankChange(player) === 'down'"
        />

        <div class="rank-change-indicator" *ngIf="hasRankChanged(player)">
          <tui-icon
            [icon]="getRankChange(player) === 'up' ? '@tui.arrow-up' : '@tui.arrow-down'"
            [class.rank-up]="getRankChange(player) === 'up'"
            [class.rank-down]="getRankChange(player) === 'down'"
          >
          </tui-icon>
        </div>
      </div>

      <div class="player-rank">
        <span class="rank-number" *ngIf="i >= 3">{{ i + 1 }}</span>
        <span class="rank-medal" *ngIf="i === 0">🥇</span>
        <span class="rank-medal" *ngIf="i === 1">🥈</span>
        <span class="rank-medal" *ngIf="i === 2">🥉</span>
      </div>

      <div class="player-info">
        <div class="player-name">
          {{ player.username }}
          <span class="current-user-badge" *ngIf="player.isCurrentUser">(Vous)</span>
        </div>
        <div class="player-status">
          <span class="status-indicator" [class.online]="player.isOnline" [class.offline]="!player.isOnline">
            {{ player.isOnline ? '●' : '○' }}
          </span>
          <span class="status-text">{{ player.isOnline ? 'En ligne' : 'Hors ligne' }}</span>
        </div>
      </div>

      <div class="player-score">
        <div class="score-value">{{ getScorePercentage(player) }}/100</div>
        <div class="score-raw">{{ player.score }} pts</div>
      </div>

      <div class="answer-indicator" *ngIf="player.lastAnswerCorrect !== undefined">
        <span
          class="answer-icon"
          [class.correct]="player.lastAnswerCorrect"
          [class.incorrect]="!player.lastAnswerCorrect"
        >
          {{ player.lastAnswerCorrect ? '✓' : '✗' }}
        </span>
      </div>
    </div>
  </div>

  <div class="scoreboard-footer">
    <div class="total-points">Score normalisé sur 100 (10 pts par bonne réponse)</div>
  </div>
</div>
