/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@taiga-ui/kit@4.36.0/fesm2022/taiga-ui-kit-components-tiles.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as e from"@angular/core";import{inject as t,signal as i,Component as r,ViewEncapsulation as n,ChangeDetectionStrategy as s,Input as o,Output as a,PLATFORM_ID as l,Injectable as p,ViewChild as d,Directive as h}from"@angular/core";import{tuiInjectElement as g,tuiGetActualTarget as c,tuiIsElement as u}from"@taiga-ui/cdk/utils/dom";import{isPlatformBrowser as m}from"@angular/common";import{MutationObserverService as y,WA_MUTATION_OBSERVER_INIT as f}from"@ng-web-apis/mutation-observer";import{ResizeObserverService as v}from"@ng-web-apis/resize-observer";import{tuiZonefreeScheduler as w}from"@taiga-ui/cdk/observables";import{tuiCreateToken as N,tuiArrayShallowEquals as b,tuiPx as D}from"@taiga-ui/cdk/utils/miscellaneous";import{Subject as x,debounce as $,timer as C,filter as P,map as _,BehaviorSubject as I,Subscription as z,combineLatest as M,distinctUntilChanged as V,startWith as O,debounceTime as S}from"rxjs";import{__decorate as T}from"tslib";import{shouldCall as R}from"@taiga-ui/event-plugins";const E=(e,t,i)=>{if(!e.has(t)||!e.has(i))return e;const r=e.get(t)??t,n=e.get(i)??i,s=new Map(e);return s.set(t,n),s.set(i,r),s},F=(e,t,i)=>{if(!e.has(t)||!e.has(i))return e;const r=e.get(t)??t,n=e.get(i)??i,s=new Map(e),o=new Map(Array.from(e).map((([e,t])=>[t,e])));if((n-r)/Math.abs(n-r)>0)for(let e=n;e>r;e--)s.set(o.get(e)??e,e-1);else for(let e=n;e<r;e++)s.set(o.get(e)??e,e+1);return s.set(t,n),s},L=N(E);class j{constructor(){this.el$=new x,this.handler=t(L),this.debounce=0,this.orderChange=this.el$.pipe($((()=>C(this.debounce))),P(this.filter.bind(this)),_((e=>this.reorder(e)))),this.element=i(null),this.el=g(),this.order$=new I(new Map)}set order(e){this.order$.next(e)}get order(){return this.order$.value}rearrange(e){this.el$.next(e)}filter(e){return!!this.element()&&!!e&&this.element()!==e}reorder(e){const t=Array.from(this.el.children),i=t.indexOf(this.element()||e),r=t.indexOf(e),n=this.order.size?new Map(this.order):new Map(t.map(((e,t)=>[t,t])));return this.order$.next(this.handler(n,i,r)),this.order$.value}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:j,deps:[],target:e.ɵɵFactoryTarget.Component})}static{this.ɵcmp=e.ɵɵngDeclareComponent({minVersion:"14.0.0",version:"16.2.12",type:j,isStandalone:!0,selector:"tui-tiles",inputs:{debounce:"debounce",order:"order"},outputs:{orderChange:"orderChange"},host:{listeners:{"pointerleave.zoneless":"rearrange()"}},providers:[v,y,{provide:f,useValue:{childList:!0}}],ngImport:e,template:"<ng-content />",isInline:!0,styles:["tui-tiles{position:relative;z-index:0;display:grid;grid-auto-flow:dense;justify-items:stretch}tui-tiles._dragged tui-tile>.t-wrapper{pointer-events:none}tui-tiles._dragged tui-tile:not(._dragged)>.t-wrapper,tui-tiles:not(._dragged) tui-tile._dragged>.t-wrapper{transition-property:all;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;transition-delay:1ms}tui-tile>.t-wrapper{position:absolute;z-index:0;border-radius:inherit}tui-tile._dragged>.t-wrapper,tui-tile:has(tui-tile._dragged)>.t-wrapper{z-index:1}\n"],changeDetection:e.ChangeDetectionStrategy.OnPush,encapsulation:e.ViewEncapsulation.None})}}e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:j,decorators:[{type:r,args:[{standalone:!0,selector:"tui-tiles",template:"<ng-content />",encapsulation:n.None,changeDetection:s.OnPush,providers:[v,y,{provide:f,useValue:{childList:!0}}],host:{"(pointerleave.zoneless)":"rearrange()"},styles:["tui-tiles{position:relative;z-index:0;display:grid;grid-auto-flow:dense;justify-items:stretch}tui-tiles._dragged tui-tile>.t-wrapper{pointer-events:none}tui-tiles._dragged tui-tile:not(._dragged)>.t-wrapper,tui-tiles:not(._dragged) tui-tile._dragged>.t-wrapper{transition-property:all;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;transition-delay:1ms}tui-tile>.t-wrapper{position:absolute;z-index:0;border-radius:inherit}tui-tile._dragged>.t-wrapper,tui-tile:has(tui-tile._dragged)>.t-wrapper{z-index:1}\n"]}]}],propDecorators:{debounce:[{type:o}],orderChange:[{type:a}],order:[{type:o}]}});class A{constructor(){this.isBrowser=m(t(l)),this.el=g(),this.tiles=t(j),this.sub=new z,this.offset$=new I([NaN,NaN]),this.position$=M([this.offset$.pipe(V(b)),t(v).pipe(O(null)),t(y).pipe(O(null)),this.tiles.order$.pipe(S(0,w()))]).pipe(_((([e])=>e)))}init(e){this.isBrowser?this.sub.add(this.position$.subscribe((t=>{this.setPosition(e,t),this.setRect(e,t)}))):this.el.style.setProperty("position","relative")}setOffset(e){this.offset$.next(e)}ngOnDestroy(){this.sub.unsubscribe()}getRect([e,t]){const i=Number.isNaN(t)?this.el.offsetTop:t,r=Number.isNaN(e)?this.el.offsetLeft:e,n={top:i,left:r,width:this.el.clientWidth,height:this.el.clientHeight,right:NaN,bottom:NaN,y:i,x:r};return{...n,toJSON:()=>JSON.stringify(n)}}setRect({style:e},t){const{top:i,left:r,width:n,height:s}=this.getRect(t);e.top=D(i),e.left=D(r),e.width=D(n),e.height=D(s)}setPosition(e,[t]){if(!Number.isNaN(t))return e.style.setProperty("position","fixed"),void e.style.setProperty("transition","none");const{style:i}=e,r=e.getBoundingClientRect(),n=this.el.getBoundingClientRect();i.removeProperty("position"),i.removeProperty("transition"),i.removeProperty("top"),i.removeProperty("left"),i.top=D(r.top-n.top+this.el.offsetTop),i.left=D(r.left-n.left+this.el.offsetLeft)}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:A,deps:[],target:e.ɵɵFactoryTarget.Injectable})}static{this.ɵprov=e.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:A})}}e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:A,decorators:[{type:p}]});class B{constructor(){this.service=t(A),this.tiles=t(j),this.dragged=i(!1),this.width=1,this.height=1,this.element=g()}onDrag(e){const t=!Number.isNaN(e[0]);this.dragged.set(this.dragged()||t),this.tiles.element.set(t?this.element:null),this.service.setOffset(e),t?this.tiles.el.classList.add("_dragged"):this.tiles.el.classList.remove("_dragged")}ngAfterViewInit(){this.wrapper&&this.service.init(this.wrapper.nativeElement)}ngOnDestroy(){this.tiles.element()===this.element&&this.tiles.element.set(null)}get column(){return`span var(--tui-width, ${this.width})`}get row(){return`span var(--tui-height, ${this.height})`}onEnter(){this.tiles.rearrange(this.element)}onTransitionEnd(){this.dragged.set(!1)}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:B,deps:[],target:e.ɵɵFactoryTarget.Component})}static{this.ɵcmp=e.ɵɵngDeclareComponent({minVersion:"14.0.0",version:"16.2.12",type:B,isStandalone:!0,selector:"tui-tile",inputs:{width:"width",height:"height"},host:{listeners:{pointerenter:"onEnter()"},properties:{"class._dragged":"dragged()","style.gridColumn":"column","style.gridRow":"row"}},providers:[A],viewQueries:[{propertyName:"wrapper",first:!0,predicate:["wrapper"],descendants:!0}],ngImport:e,template:'<div\n    #wrapper\n    class="t-wrapper"\n    (transitionend.self)="onTransitionEnd()"\n>\n    <ng-content />\n</div>\n',changeDetection:e.ChangeDetectionStrategy.OnPush})}}e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:B,decorators:[{type:r,args:[{standalone:!0,selector:"tui-tile",changeDetection:s.OnPush,providers:[A],host:{"[class._dragged]":"dragged()","[style.gridColumn]":"column","[style.gridRow]":"row","(pointerenter)":"onEnter()"},template:'<div\n    #wrapper\n    class="t-wrapper"\n    (transitionend.self)="onTransitionEnd()"\n>\n    <ng-content />\n</div>\n'}]}],propDecorators:{wrapper:[{type:d,args:["wrapper"]}],width:[{type:o}],height:[{type:o}]}});class k{constructor(){this.tile=t(B),this.x=NaN,this.y=NaN}onPointer(e=NaN,t=NaN){const{left:i,top:r}=this.tile.element.getBoundingClientRect();this.x=e-i,this.y=t-r,this.tile.onDrag([NaN,NaN])}onMove(e,t){this.tile.onDrag([e-this.x,t-this.y])}onStart(e){const t=c(e),{x:i,y:r,pointerId:n}=e;u(t)&&t.releasePointerCapture(n),this.onPointer(i,r)}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:k,deps:[],target:e.ɵɵFactoryTarget.Directive})}static{this.ɵdir=e.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:k,isStandalone:!0,selector:"[tuiTileHandle]",host:{listeners:{"pointerdown.zoneless.prevent":"onStart($event)","document:pointerup.zoneless":"onPointer()","document:pointermove.zoneless":"onMove($event.x, $event.y)"},properties:{"style.touchAction":'"none"',"style.userSelect":'"none"'}},ngImport:e})}}T([R((function(e=NaN){return!Number.isNaN(e)||!Number.isNaN(this.x)}))],k.prototype,"onPointer",null),T([R((function(){return!Number.isNaN(this.x)}))],k.prototype,"onMove",null),e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:k,decorators:[{type:h,args:[{standalone:!0,selector:"[tuiTileHandle]",host:{"[style.touchAction]":'"none"',"[style.userSelect]":'"none"',"(pointerdown.zoneless.prevent)":"onStart($event)","(document:pointerup.zoneless)":"onPointer()","(document:pointermove.zoneless)":"onMove($event.x, $event.y)"}}]}],propDecorators:{onPointer:[],onMove:[]}});const H=[j,B,k];export{L as TUI_TILES_REORDER,B as TuiTile,k as TuiTileHandle,A as TuiTileService,H as TuiTiles,j as TuiTilesComponent,F as tuiTilesShift,E as tuiTilesSwap};export default null;
