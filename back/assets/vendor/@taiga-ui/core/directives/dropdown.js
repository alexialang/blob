/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@taiga-ui/core@4.36.0/fesm2022/taiga-ui-core-directives-dropdown.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as t from"@angular/core";import{Injectable as e,Directive as i,inject as o,Input as n,EventEmitter as r,Output as s,ChangeDetectorRef as a,INJECTOR as p,signal as c,TemplateRef as d,computed as l,Component as h,ChangeDetectionStrategy as u,ElementRef as g,ContentChild as m,ViewContainerRef as D,Optional as v,Self as w,SkipSelf as y}from"@angular/core";import{takeUntilDestroyed as f,toObservable as C}from"@angular/core/rxjs-interop";import*as b from"@taiga-ui/cdk/directives/active-zone";import{TuiActiveZone as x}from"@taiga-ui/cdk/directives/active-zone";import{tuiInjectElement as O,tuiPointToClientRect as I,tuiGetActualTarget as S,tuiIsElement as V,tuiIsHTMLElement as k,tuiIsElementEditable as M,tuiIsTextNode as F,tuiIsTextfield as H}from"@taiga-ui/cdk/utils/dom";import{tuiClamp as A}from"@taiga-ui/cdk/utils/math";import{tuiCreateTokenFromFactory as E,tuiCreateToken as R,tuiProvide as T,tuiPure as $,tuiPx as z,tuiIsString as P,tuiProvideOptions as Z,tuiDirectiveBinding as W}from"@taiga-ui/cdk/utils/miscellaneous";import{tuiDropdownAnimation as B}from"@taiga-ui/core/animations";import{TuiDriverDirective as j,TuiPositionAccessor as L,tuiFallbackAccessor as N,TuiRectAccessor as K,tuiAsRectAccessor as q,tuiAsVehicle as G,tuiPositionAccessorFor as U,tuiRectAccessorFor as X,tuiAsDriver as Y,TuiDriver as J,tuiAsPositionAccessor as Q}from"@taiga-ui/core/classes";import{TuiScrollbar as _}from"@taiga-ui/core/components/scrollbar";import{TuiVisualViewportService as tt,TuiPositionService as et}from"@taiga-ui/core/services";import{TUI_VIEWPORT as it,TUI_ANIMATIONS_SPEED as ot,TUI_DARK_MODE as nt,TUI_SELECTION_STREAM as rt}from"@taiga-ui/core/tokens";import{tuiCheckFixedPosition as st,tuiToAnimationOptions as at,tuiGetWordRange as pt,tuiOverrideOptions as ct}from"@taiga-ui/core/utils";import{PolymorpheusComponent as dt,PolymorpheusTemplate as lt,PolymorpheusOutlet as ht}from"@taiga-ui/polymorpheus";import{BehaviorSubject as ut,Subject as gt,throttleTime as mt,takeWhile as Dt,map as vt,merge as wt,filter as yt,fromEvent as ft,switchMap as Ct,delay as bt,startWith as xt,takeUntil as Ot,distinctUntilChanged as It,of as St,tap as Vt,share as kt,combineLatest as Mt}from"rxjs";import{coerceArray as Ft}from"@angular/cdk/coercion";import{tuiZonefreeScheduler as Ht,tuiIfMap as At,tuiCloseWatcher as Et,tuiZonefull as Rt,tuiWatch as Tt,tuiTypedFromEvent as $t,tuiZoneOptimized as zt}from"@taiga-ui/cdk/observables";import{TuiPortalService as Pt,TuiPortals as Zt,tuiAsPortal as Wt}from"@taiga-ui/cdk/classes";import{__decorate as Bt}from"tslib";import{EMPTY_CLIENT_RECT as jt,TUI_TRUE_HANDLER as Lt,CHAR_ZERO_WIDTH_SPACE as Nt,CHAR_NO_BREAK_SPACE as Kt}from"@taiga-ui/cdk/constants";import{TUI_IS_TOUCH as qt,TUI_RANGE as Gt}from"@taiga-ui/cdk/tokens";import{shouldCall as Ut}from"@taiga-ui/event-plugins";import{DOCUMENT as Xt}from"@angular/common";import*as Yt from"@taiga-ui/cdk/directives/obscured";import{TuiObscured as Jt}from"@taiga-ui/cdk/directives/obscured";import{tuiIsNativeKeyboardFocusable as Qt,tuiGetClosestFocusable as _t,tuiIsNativeFocusedIn as te,tuiGetNativeFocused as ee}from"@taiga-ui/cdk/utils/focus";import{tuiIsEditingKey as ie,tuiOverrideOptions as oe}from"@taiga-ui/core/utils/miscellaneous";class ne extends ut{constructor(){super(!1),this.type="dropdown"}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ne,deps:[],target:t.ɵɵFactoryTarget.Injectable})}static{this.ɵprov=t.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ne})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ne,decorators:[{type:e}],ctorParameters:function(){return[]}});class re extends j{constructor(){super(...arguments),this.type="dropdown"}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:re,deps:null,target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:re,isStandalone:!0,usesInheritance:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:re,decorators:[{type:i,args:[{standalone:!0}]}]});const se=E((()=>me)),ae=R();class pe extends Pt{static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:pe,deps:null,target:t.ɵɵFactoryTarget.Injectable})}static{this.ɵprov=t.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:pe,providedIn:"root"})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:pe,decorators:[{type:e,args:[{providedIn:"root"}]}]});const ce={align:"left",direction:null,limitWidth:"auto",maxHeight:400,minHeight:80,offset:4,appearance:""},de=R(ce),le=t=>({provide:de,deps:[[new v,new w,he],[new v,new y,de]],useFactory:ct(t,ce)});class he{constructor(){this.options=o(de,{skipSelf:!0}),this.align=this.options.align,this.appearance=this.options.appearance,this.direction=this.options.direction,this.limitWidth=this.options.limitWidth,this.minHeight=this.options.minHeight,this.maxHeight=this.options.maxHeight,this.offset=this.options.offset}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:he,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:he,isStandalone:!0,selector:"[tuiDropdownAlign], [tuiDropdownAppearance], [tuiDropdownDirection], [tuiDropdownLimitWidth], [tuiDropdownMinHeight], [tuiDropdownMaxHeight], [tuiDropdownOffset]",inputs:{align:["tuiDropdownAlign","align"],appearance:["tuiDropdownAppearance","appearance"],direction:["tuiDropdownDirection","direction"],limitWidth:["tuiDropdownLimitWidth","limitWidth"],minHeight:["tuiDropdownMinHeight","minHeight"],maxHeight:["tuiDropdownMaxHeight","maxHeight"],offset:["tuiDropdownOffset","offset"]},providers:[T(de,he)],ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:he,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownAlign], [tuiDropdownAppearance], [tuiDropdownDirection], [tuiDropdownLimitWidth], [tuiDropdownMinHeight], [tuiDropdownMaxHeight], [tuiDropdownOffset]",providers:[T(de,he)]}]}],propDecorators:{align:[{type:n,args:["tuiDropdownAlign"]}],appearance:[{type:n,args:["tuiDropdownAppearance"]}],direction:[{type:n,args:["tuiDropdownDirection"]}],limitWidth:[{type:n,args:["tuiDropdownLimitWidth"]}],minHeight:[{type:n,args:["tuiDropdownMinHeight"]}],maxHeight:[{type:n,args:["tuiDropdownMaxHeight"]}],offset:[{type:n,args:["tuiDropdownOffset"]}]}});class ue extends L{constructor(){super(...arguments),this.options=o(de),this.viewport=o(it),this.directionChange=new r,this.type="dropdown",this.accessor=N("dropdown")(o(K),o(ge,{optional:!0}))}emitDirection(t){this.directionChange.emit(t)}getPosition({width:t,height:e}){t||e||(this.previous=void 0);const i=this.accessor?.getClientRect()??jt,o=this.viewport.getClientRect(),{minHeight:n,align:r,direction:s,offset:a,limitWidth:p}=this.options,c={top:o.top-a,bottom:o.bottom+a,right:o.right-a,left:o.left+a},d=this.previous||s||"bottom",l={top:i.top-2*a-c.top,bottom:c.bottom-i.bottom-2*a},h="fixed"===p?i.width:t,u=Math.max(i.right-h,a),g=i.left+t<c.right?i.left:u,m={top:i.top-a-e,bottom:i.bottom+a,right:Math.max(c.left,u),center:i.left+i.width/2+t/2<c.right?i.left+i.width/2-t/2:u,left:Math.max(c.left,g)},D=l.top>l.bottom?"top":"bottom";return l[d]>n&&s||l[d]>e?(this.emitDirection(d),[m[d],m[r]]):(this.previous=D,this.emitDirection(D),[m[D],m[r]])}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ue,deps:null,target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:ue,isStandalone:!0,outputs:{directionChange:"tuiDropdownDirectionChange"},usesInheritance:!0,ngImport:t})}}Bt([$],ue.prototype,"emitDirection",null),t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ue,decorators:[{type:i,args:[{standalone:!0}]}],propDecorators:{directionChange:[{type:s,args:["tuiDropdownDirectionChange"]}],emitDirection:[]}});class ge{constructor(){this.refresh$=new gt,this.service=o(pe),this.cdr=o(a),this.drivers=Ft(o(ne,{self:!0,optional:!0})),this.sub=this.refresh$.pipe(mt(0,Ht()),f()).subscribe((()=>{this.ref()?.changeDetectorRef.detectChanges(),this.ref()?.changeDetectorRef.markForCheck()})),this.el=O(),this.type="dropdown",this.component=new dt(o(se),o(p)),this.ref=c(null)}set tuiDropdown(t){this.content=t instanceof d?new lt(t,this.cdr):t}get position(){return st(this.el)?"fixed":"absolute"}ngAfterViewChecked(){this.refresh$.next()}ngOnChanges(){this.content||this.toggle(!1)}ngOnDestroy(){this.toggle(!1)}getClientRect(){return this.el.getBoundingClientRect()}toggle(t){const e=this.ref();t&&this.content&&!e?this.ref.set(this.service.add(this.component)):!t&&e&&(this.ref.set(null),this.service.remove(e)),this.drivers.forEach((e=>e?.next(t))),this.cdr.markForCheck()}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ge,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:ge,isStandalone:!0,selector:"[tuiDropdown]:not(ng-container):not(ng-template)",inputs:{tuiDropdown:"tuiDropdown"},host:{properties:{"class.tui-dropdown-open":"ref()"}},providers:[q(ge),G(ge)],exportAs:["tuiDropdown"],usesOnChanges:!0,hostDirectives:[{directive:re},{directive:ue,outputs:["tuiDropdownDirectionChange","tuiDropdownDirectionChange"]}],ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:ge,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdown]:not(ng-container):not(ng-template)",providers:[q(ge),G(ge)],exportAs:"tuiDropdown",hostDirectives:[re,{directive:ue,outputs:["tuiDropdownDirectionChange"]}],host:{"[class.tui-dropdown-open]":"ref()"}}]}],propDecorators:{tuiDropdown:[{type:n}]}});class me{constructor(){this.el=O(),this.accessor=o(K),this.viewport=o(it),this.vvs=o(tt),this.animation=at(o(ot)),this.options=o(de),this.directive=o(ge),this.context=o(ae,{optional:!0}),this.darkMode=o(nt),this.position=this.directive.position,this.theme=l(((t=this.darkMode())=>this.directive.el.closest("[tuiTheme]")?.getAttribute("tuiTheme"))),this.sub=o(et).pipe(Dt((()=>this.directive.el.isConnected&&!!this.directive.el.getBoundingClientRect().height)),vt((t=>"fixed"===this.directive.position?this.vvs.correct(t):t)),vt((([t,e])=>this.getStyles(e,t))),f()).subscribe({next:t=>Object.assign(this.el.style,t),complete:()=>this.close?.()}),this.close=()=>this.directive.toggle(!1)}getStyles(t,e){const{maxHeight:i,minHeight:o,offset:n,limitWidth:r}=this.options,{left:s=0,top:a=0}=this.el.offsetParent?.getBoundingClientRect()||{},p=this.accessor.getClientRect(),c=this.viewport.getClientRect(),d=p.top-c.top-2*n,l=c.top+c.height-e-n,h=e>p.bottom?l:d,u=this.el.getBoundingClientRect().right<=p.left||t>=p.right?i:A(h,o,i);return e-=a,t-=s,{position:this.position,top:z(Math.round(Math.max(e,n-a))),left:z(Math.round(t)),maxHeight:z(Math.round(u)),width:"fixed"===r?z(Math.round(p.width)):"",minWidth:"min"===r?z(Math.round(p.width)):""}}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:me,deps:[],target:t.ɵɵFactoryTarget.Component})}static{this.ɵcmp=t.ɵɵngDeclareComponent({minVersion:"14.0.0",version:"16.2.12",type:me,isStandalone:!0,selector:"tui-dropdown",host:{properties:{"@tuiDropdownAnimation":"animation","attr.data-appearance":"options.appearance","attr.tuiTheme":"theme()"}},providers:[et,U("dropdown",ue),X("dropdown",ge)],hostDirectives:[{directive:b.TuiActiveZone}],ngImport:t,template:'<tui-scrollbar class="t-scroll">\n    <div\n        *polymorpheusOutlet="directive.content as text; context: {$implicit: close}"\n        class="t-primitive"\n    >\n        {{ text }}\n    </div>\n</tui-scrollbar>\n',styles:[":host{position:absolute;display:flex;box-shadow:var(--tui-shadow-medium);color:var(--tui-text-primary);background:var(--tui-background-elevation-3);border-radius:var(--tui-radius-m);overflow:hidden;border:1px solid var(--tui-border-normal);box-sizing:border-box;max-inline-size:calc(100% - 8px);isolation:isolate;pointer-events:auto}:host.ng-animating{pointer-events:none}:host:not([style*=top]){visibility:hidden}.t-scroll{flex-grow:1;max-inline-size:100%;inline-size:-webkit-max-content;inline-size:max-content;overscroll-behavior:none}.t-primitive{padding:1rem}\n"],dependencies:[{kind:"directive",type:ht,selector:"[polymorpheusOutlet]",inputs:["polymorpheusOutlet","polymorpheusOutletContext"]},{kind:"component",type:_,selector:"tui-scrollbar",inputs:["hidden"]}],animations:[B],changeDetection:t.ChangeDetectionStrategy.Default})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:me,decorators:[{type:h,args:[{standalone:!0,selector:"tui-dropdown",imports:[ht,_],changeDetection:u.Default,providers:[et,U("dropdown",ue),X("dropdown",ge)],animations:[B],hostDirectives:[x],host:{"[@tuiDropdownAnimation]":"animation","[attr.data-appearance]":"options.appearance","[attr.tuiTheme]":"theme()"},template:'<tui-scrollbar class="t-scroll">\n    <div\n        *polymorpheusOutlet="directive.content as text; context: {$implicit: close}"\n        class="t-primitive"\n    >\n        {{ text }}\n    </div>\n</tui-scrollbar>\n',styles:[":host{position:absolute;display:flex;box-shadow:var(--tui-shadow-medium);color:var(--tui-text-primary);background:var(--tui-background-elevation-3);border-radius:var(--tui-radius-m);overflow:hidden;border:1px solid var(--tui-border-normal);box-sizing:border-box;max-inline-size:calc(100% - 8px);isolation:isolate;pointer-events:auto}:host.ng-animating{pointer-events:none}:host:not([style*=top]){visibility:hidden}.t-scroll{flex-grow:1;max-inline-size:100%;inline-size:-webkit-max-content;inline-size:max-content;overscroll-behavior:none}.t-primitive{padding:1rem}\n"]}]}]});class De extends K{constructor(){super(...arguments),this.isTouch=o(qt),this.currentRect=jt,this.userSelect=l((()=>this.isTouch()?"none":null)),this.activeZone=o(x),this.driver=o(ne),this.type="dropdown"}getClientRect(){return this.currentRect}closeDropdown(t){this.driver.next(!1),this.currentRect=jt}onContextMenu(t,e){this.currentRect=I(t,e),this.driver.next(!0)}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:De,deps:null,target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:De,isStandalone:!0,selector:"[tuiDropdownContext]",host:{listeners:{"document:pointerdown.zoneless":"closeDropdown($event)","document:contextmenu.capture.zoneless":"closeDropdown($event)","document:keydown.esc":"closeDropdown()",longtap:"onContextMenu($event.detail.clientX, $event.detail.clientY)"},properties:{"style.user-select":"userSelect()","style.-webkit-user-select":"userSelect()","style.-webkit-touch-callout":"userSelect()"}},providers:[x,ne,Y(ne),q(De)],usesInheritance:!0,ngImport:t})}}Bt([Ut((function(t){return!t||this.driver.value&&!this.activeZone.contains(S(t))}))],De.prototype,"closeDropdown",null),t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:De,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownContext]",providers:[x,ne,Y(ne),q(De)],host:{"[style.user-select]":"userSelect()","[style.-webkit-user-select]":"userSelect()","[style.-webkit-touch-callout]":"userSelect()","(document:pointerdown.zoneless)":"closeDropdown($event)","(document:contextmenu.capture.zoneless)":"closeDropdown($event)","(document:keydown.esc)":"closeDropdown()","(longtap)":"onContextMenu($event.detail.clientX, $event.detail.clientY)"}}]}],propDecorators:{closeDropdown:[]}});const ve={showDelay:200,hideDelay:500},we=R(ve);function ye(t){return Z(we,t,ve)}class fe{constructor(){this.directive=o(ge),this.el=O(),this.obscured=o(Jt),this.activeZone=o(x),this.dropdown=l((()=>this.directive.ref()?.location.nativeElement)),this.tuiDropdownEnabled=!0,this.tuiDropdownOpen=!1,this.tuiDropdownOpenChange=new r,this.driver=o(ne),this.sub=this.driver.pipe(At((()=>wt(Et(),this.obscured.tuiObscured.pipe(yt(Boolean)),this.activeZone.tuiActiveZoneChange.pipe(yt((t=>!t))),ft(this.el,"focusin").pipe(yt((t=>!this.host.contains(S(t))||!this.directive.ref())))))),Rt(),Tt(),f()).subscribe((()=>this.toggle(!1))),this.sync=this.driver.pipe(f()).subscribe((t=>{t!==this.tuiDropdownOpen&&this.update(t)}))}ngOnChanges(){this.drive(!!this.tuiDropdownOpen),this.tuiDropdownOpenChange.emit(!!this.tuiDropdownOpen)}toggle(t){this.focused&&!t&&this.host.focus({preventScroll:!0}),this.update(t)}onEsc(t){t.preventDefault(),this.toggle(!1)}onClick(t){!this.editable&&this.host.contains(t)&&this.update(!this.tuiDropdownOpen)}onArrow(t,e){V(t.target)&&this.host.contains(t.target)&&this.tuiDropdownEnabled&&this.directive.content&&(t.preventDefault(),this.focusDropdown(e))}onKeydown({key:t,target:e,defaultPrevented:i}){!i&&ie(t)&&this.editable&&this.focused&&k(e)&&!M(e)&&this.host.focus({preventScroll:!0})}get host(){const t=this.dropdownHost?.nativeElement||this.el,e=Qt(t)?t:_t({initial:t,root:this.el});return this.dropdownHost?.nativeElement||e||this.el}get editable(){return M(this.host)}get focused(){return te(this.host)||te(this.dropdown())}update(t){if(t&&!this.tuiDropdownEnabled)return this.drive();this.tuiDropdownOpen=t,this.tuiDropdownOpenChange.emit(t),this.drive()}drive(t=!!this.tuiDropdownOpen&&this.tuiDropdownEnabled){this.obscured.tuiObscuredEnabled=t,this.driver.next(t)}focusDropdown(t){const e=this.dropdown();if(!e)return void this.update(!0);const i=this.el.ownerDocument,o=e.appendChild(i.createElement("div")),n=_t({initial:t?o:e,previous:t,root:e});o.remove(),n?.focus()}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:fe,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:fe,isStandalone:!0,selector:"[tuiDropdown][tuiDropdownOpen],[tuiDropdown][tuiDropdownOpenChange]",inputs:{tuiDropdownEnabled:"tuiDropdownEnabled",tuiDropdownOpen:"tuiDropdownOpen"},outputs:{tuiDropdownOpenChange:"tuiDropdownOpenChange"},host:{listeners:{click:"onClick($event.target)","keydown.arrowDown":"onArrow($event, false)","keydown.arrowUp":"onArrow($event, true)","document:keydown.zoneless.capture":"onEsc($event)","document:keydown.zoneless":"onKeydown($event)",tuiActiveZoneChange:"0"}},providers:[ne,Y(ne)],queries:[{propertyName:"dropdownHost",first:!0,predicate:["tuiDropdownHost"],descendants:!0,read:g}],usesOnChanges:!0,hostDirectives:[{directive:Yt.TuiObscured},{directive:b.TuiActiveZone,inputs:["tuiActiveZoneParent","tuiActiveZoneParent"],outputs:["tuiActiveZoneChange","tuiActiveZoneChange"]}],ngImport:t})}}Bt([Ut((function(t){return"undefined"==typeof CloseWatcher&&"escape"===t.key?.toLowerCase()&&this.tuiDropdownEnabled&&!!this.tuiDropdownOpen&&!this.dropdown()?.nextElementSibling}))],fe.prototype,"onEsc",null),t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:fe,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdown][tuiDropdownOpen],[tuiDropdown][tuiDropdownOpenChange]",providers:[ne,Y(ne)],hostDirectives:[Jt,{directive:x,inputs:["tuiActiveZoneParent"],outputs:["tuiActiveZoneChange"]}],host:{"(click)":"onClick($event.target)","(keydown.arrowDown)":"onArrow($event, false)","(keydown.arrowUp)":"onArrow($event, true)","(document:keydown.zoneless.capture)":"onEsc($event)","(document:keydown.zoneless)":"onKeydown($event)","(tuiActiveZoneChange)":"0"}}]}],propDecorators:{dropdownHost:[{type:m,args:["tuiDropdownHost",{descendants:!0,read:g}]}],tuiDropdownEnabled:[{type:n}],tuiDropdownOpen:[{type:n}],tuiDropdownOpenChange:[{type:s}],onEsc:[]}});class Ce extends J{constructor(){super((t=>this.stream$.subscribe(t))),this.el=O(),this.doc=o(Xt),this.options=o(we),this.activeZone=o(x),this.open=o(fe,{optional:!0}),this.dropdownExternalRemoval$=C(o(ge).ref).pipe(yt((t=>!t&&this.hovered))),this.stream$=wt(this.dropdownExternalRemoval$.pipe(Ct((()=>$t(this.doc,"pointerdown").pipe(vt(S),bt(this.hideDelay),xt(null),Ot(ft(this.doc,"mouseover")))))),$t(this.doc,"mouseover").pipe(vt(S)),$t(this.doc,"mouseout").pipe(vt((t=>t.relatedTarget)))).pipe(vt((t=>V(t)&&this.isHovered(t))),It(),Ct((t=>St(t).pipe(bt(t?this.showDelay:this.hideDelay)))),zt(),Vt((t=>{this.hovered=t,this.open?.toggle(t)})),kt()),this.showDelay=this.options.showDelay,this.hideDelay=this.options.hideDelay,this.hovered=!1,this.type="dropdown"}onClick(t){this.hovered&&this.open&&t.preventDefault()}isHovered(t){const e=(this.dropdownHost?.nativeElement||this.el).contains(t),i=!this.el.contains(t)&&this.activeZone.contains(t);return e||i}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ce,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Ce,isStandalone:!0,selector:"[tuiDropdownHover]",inputs:{showDelay:["tuiDropdownShowDelay","showDelay"],hideDelay:["tuiDropdownHideDelay","hideDelay"]},host:{listeners:{"click.capture":"onClick($event)"}},providers:[x,Y(Ce)],queries:[{propertyName:"dropdownHost",first:!0,predicate:["tuiDropdownHost"],descendants:!0,read:g}],usesInheritance:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ce,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownHover]",providers:[x,Y(Ce)],host:{"(click.capture)":"onClick($event)"}}]}],ctorParameters:function(){return[]},propDecorators:{dropdownHost:[{type:m,args:["tuiDropdownHost",{descendants:!0,read:g}]}],showDelay:[{type:n,args:["tuiDropdownShowDelay"]}],hideDelay:[{type:n,args:["tuiDropdownHideDelay"]}]}});class be{constructor(){this.driver=o(ne),this.tuiDropdownManual=!1}ngOnChanges(){this.driver.next(!!this.tuiDropdownManual)}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:be,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:be,isStandalone:!0,selector:"[tuiDropdownManual]",inputs:{tuiDropdownManual:"tuiDropdownManual"},providers:[ne,Y(ne)],usesOnChanges:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:be,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownManual]",providers:[ne,Y(ne)]}]}],propDecorators:{tuiDropdownManual:[{type:n}]}});class xe{constructor(){this.openStateSub=new gt,this.tuiDropdownOpenChange=this.openStateSub.pipe(It())}set tuiDropdownOpen(t){this.emitOpenChange(t)}emitOpenChange(t){this.openStateSub.next(t)}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:xe,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:xe,isStandalone:!0,selector:"[tuiDropdownOpen]:not([tuiDropdown]),[tuiDropdownOpenChange]:not([tuiDropdown])",inputs:{tuiDropdownOpen:"tuiDropdownOpen"},outputs:{tuiDropdownOpenChange:"tuiDropdownOpenChange"},ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:xe,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownOpen]:not([tuiDropdown]),[tuiDropdownOpenChange]:not([tuiDropdown])"}]}],propDecorators:{tuiDropdownOpenChange:[{type:s}],tuiDropdownOpen:[{type:n}]}});class Oe{constructor(){this.template=o(d),this.service=o(pe)}set tuiDropdown(t){this.viewRef?.destroy(),t&&(this.viewRef=this.service.addTemplate(this.template))}ngOnDestroy(){this.viewRef?.destroy()}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Oe,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Oe,isStandalone:!0,selector:"ng-template[tuiDropdown]",inputs:{tuiDropdown:"tuiDropdown"},ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Oe,decorators:[{type:i,args:[{standalone:!0,selector:"ng-template[tuiDropdown]"}]}],propDecorators:{tuiDropdown:[{type:n}]}});class Ie extends L{constructor(){super(...arguments),this.options=o(de),this.viewport=o(it),this.vertical=o(ue),this.previous=this.options.direction||"bottom",this.tuiDropdownSided="",this.tuiDropdownSidedOffset=4,this.type="dropdown"}getPosition(t){if(!1===this.tuiDropdownSided)return this.vertical.getPosition(t);const{height:e,width:i}=t,o=this.vertical.accessor?.getClientRect()??jt,n=this.viewport.getClientRect(),{direction:r,minHeight:s,offset:a}=this.options,p="center"===this.options.align?"left":this.options.align,c={top:o.bottom-n.top,left:o.left-a-n.left,right:n.right-o.right-a,bottom:n.bottom-o.top},d={top:o.bottom-e+this.tuiDropdownSidedOffset+1,left:o.left-i-a,right:o.right+a,bottom:o.top-this.tuiDropdownSidedOffset-1},l=c.top>c.bottom?"top":"bottom",h=c[p]>i?d[p]:c.left>c.right?d.left:d.right;return c[this.previous]>s&&r||this.previous===l?(this.vertical.emitDirection(this.previous),[d[this.previous],h]):(this.previous=l,this.vertical.emitDirection(l),[d[l],h])}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ie,deps:null,target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Ie,isStandalone:!0,selector:"[tuiDropdownSided]",inputs:{tuiDropdownSided:"tuiDropdownSided",tuiDropdownSidedOffset:"tuiDropdownSidedOffset"},providers:[ue,Q(Ie)],usesInheritance:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ie,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownSided]",providers:[ue,Q(Ie)]}]}],propDecorators:{tuiDropdownSided:[{type:n}],tuiDropdownSidedOffset:[{type:n}]}});class Se extends J{constructor(){super((t=>this.stream$.subscribe(t))),this.doc=o(Xt),this.vcr=o(D),this.dropdown=o(ge),this.el=O(),this.handler$=new ut(Lt),this.stream$=Mt([this.handler$,o(rt).pipe(vt((()=>this.getRange())),yt((t=>this.isValid(t))),It(((t,e)=>t.startOffset===e.startOffset&&t.endOffset===e.endOffset&&t.commonAncestorContainer===e.commonAncestorContainer)))]).pipe(vt((([t,e])=>{const i=this.el.contains(e.commonAncestorContainer);return this.range=i&&F(e.commonAncestorContainer)?e:this.range,i&&t(this.range)||this.inDropdown(e)}))),this.range=o(Gt),this.position="selection",this.type="dropdown"}set tuiDropdownSelection(t){P(t)||this.handler$.next(t)}getClientRect(){switch(this.position){case"tag":{const{commonAncestorContainer:t}=this.range,e=V(t)?t:t.parentNode;return e&&V(e)?e.getBoundingClientRect():jt}case"word":return pt(this.range).getBoundingClientRect();default:return this.range.getBoundingClientRect()}}ngOnDestroy(){this.ghost&&this.vcr.element.nativeElement.removeChild(this.ghost)}getRange(){const t=ee(this.doc),e=this.doc.getSelection();return(t&&H(t)&&this.el.contains(t)?this.veryVerySadInputFix(t):e?.rangeCount&&e.getRangeAt(0)||this.range).cloneRange()}inDropdown(t){const{startContainer:e,endContainer:i}=t,o=this.boxContains(t.commonAncestorContainer),n=this.boxContains(i)&&this.el.contains(e),r=this.boxContains(e)&&this.el.contains(i);return o||n||r}boxContains(t){return!!this.dropdown.ref()?.location.nativeElement.contains(t)}isValid(t){return!this.el.contains(t.commonAncestorContainer)||!this.el.closest("tui-textfield")||t.intersectsNode(this.ghost||this.el)}veryVerySadInputFix(t){const{ghost:e=this.initGhost(t)}=this,{top:i,left:o,width:n,height:r}=t.getBoundingClientRect(),{selectionStart:s,selectionEnd:a,value:p}=t,c=this.doc.createRange(),d=this.el.getBoundingClientRect();return e.style.top=z(i-d.top),e.style.left=z(o-d.left),e.style.width=z(n),e.style.height=z(r),e.textContent=Nt+p+Kt,c.setStart(e.firstChild,s||0),c.setEnd(e.firstChild,a||0),c}initGhost(t){const e=this.doc.createElement("div"),{font:i,letterSpacing:o,textTransform:n,padding:r,borderTop:s}=getComputedStyle(t);return e.style.position="absolute",e.style.pointerEvents="none",e.style.opacity="0",e.style.whiteSpace="pre-wrap",e.style.boxSizing="border-box",e.style.borderTop=s,e.style.font=i,e.style.letterSpacing=o,e.style.textTransform=n,e.style.padding=r,this.vcr.element.nativeElement.appendChild(e),this.ghost=e,e}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Se,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Se,isStandalone:!0,selector:"[tuiDropdownSelection]",inputs:{position:["tuiDropdownSelectionPosition","position"],tuiDropdownSelection:"tuiDropdownSelection"},providers:[Y(Se),q(Se)],usesInheritance:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Se,decorators:[{type:i,args:[{standalone:!0,selector:"[tuiDropdownSelection]",providers:[Y(Se),q(Se)]}]}],ctorParameters:function(){return[]},propDecorators:{position:[{type:n,args:["tuiDropdownSelectionPosition"]}],tuiDropdownSelection:[{type:n}]}});const Ve=[he,re,ge,me,fe,xe,Oe,be,Ce,De,ue,Ie,Se];function ke(t){return W(ge,"tuiDropdown",t,{})}function Me(t){return W(fe,"tuiDropdownEnabled",t,{})}function Fe(){const t=W(fe,"tuiDropdownOpen",!1,{});return o(fe).tuiDropdownOpenChange.pipe(f()).subscribe((e=>t.set(e))),t}class He{constructor(){oe({limitWidth:"fixed"},ce)(o(de,{self:!0,optional:!0}),null)}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:He,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:He,isStandalone:!0,providers:[le({})],ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:He,decorators:[{type:i,args:[{standalone:!0,providers:[le({})]}]}],ctorParameters:function(){return[]}});class Ae{constructor(){o(de).limitWidth="auto"}static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ae,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Ae,isStandalone:!0,ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ae,decorators:[{type:i,args:[{standalone:!0}]}],ctorParameters:function(){return[]}});class Ee extends Zt{static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ee,deps:null,target:t.ɵɵFactoryTarget.Component})}static{this.ɵcmp=t.ɵɵngDeclareComponent({minVersion:"14.0.0",version:"16.2.12",type:Ee,isStandalone:!0,selector:"tui-dropdowns",host:{styleAttribute:"position: absolute; width: 100%; top: 0"},providers:[Wt(pe)],usesInheritance:!0,ngImport:t,template:"<ng-container #viewContainer />",isInline:!0,changeDetection:t.ChangeDetectionStrategy.OnPush})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Ee,decorators:[{type:h,args:[{standalone:!0,selector:"tui-dropdowns",template:"<ng-container #viewContainer />",changeDetection:u.OnPush,providers:[Wt(pe)],host:{style:"position: absolute; width: 100%; top: 0"}}]}]});class Re{static{this.ɵfac=t.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Re,deps:[],target:t.ɵɵFactoryTarget.Directive})}static{this.ɵdir=t.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:Re,isStandalone:!0,hostDirectives:[{directive:fe,inputs:["tuiDropdownOpen","open","tuiDropdownEnabled","tuiDropdownEnabled"],outputs:["tuiDropdownOpenChange","openChange"]}],ngImport:t})}}t.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:t,type:Re,decorators:[{type:i,args:[{standalone:!0,hostDirectives:[{directive:fe,inputs:["tuiDropdownOpen: open","tuiDropdownEnabled"],outputs:["tuiDropdownOpenChange: openChange"]}]}]}]});export{se as TUI_DROPDOWN_COMPONENT,ae as TUI_DROPDOWN_CONTEXT,ce as TUI_DROPDOWN_DEFAULT_OPTIONS,ve as TUI_DROPDOWN_HOVER_DEFAULT_OPTIONS,we as TUI_DROPDOWN_HOVER_OPTIONS,de as TUI_DROPDOWN_OPTIONS,Ve as TuiDropdown,Ae as TuiDropdownAuto,me as TuiDropdownComponent,De as TuiDropdownContext,ge as TuiDropdownDirective,ne as TuiDropdownDriver,re as TuiDropdownDriverDirective,He as TuiDropdownFixed,Ce as TuiDropdownHover,be as TuiDropdownManual,fe as TuiDropdownOpen,xe as TuiDropdownOpenLegacy,he as TuiDropdownOptionsDirective,Oe as TuiDropdownPortal,ue as TuiDropdownPosition,Ie as TuiDropdownPositionSided,Se as TuiDropdownSelection,pe as TuiDropdownService,Ee as TuiDropdowns,Re as TuiWithDropdownOpen,ke as tuiDropdown,Me as tuiDropdownEnabled,ye as tuiDropdownHoverOptionsProvider,Fe as tuiDropdownOpen,le as tuiDropdownOptionsProvider};export default null;
