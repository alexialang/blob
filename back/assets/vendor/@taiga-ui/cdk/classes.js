/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@taiga-ui/cdk@4.36.0/fesm2022/taiga-ui-cdk-classes.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{__decorate as t}from"tslib";import*as e from"@angular/core";import{inject as r,signal as s,ChangeDetectorRef as o,computed as i,Directive as n,Input as a,INJECTOR as l,ViewContainerRef as c,ViewChild as h,Injectable as d}from"@angular/core";import{takeUntilDestroyed as p}from"@angular/core/rxjs-interop";import{NgControl as u,NgModel as m}from"@angular/forms";import{EMPTY_FUNCTION as v}from"@taiga-ui/cdk/constants";import{TUI_FALLBACK_VALUE as g}from"@taiga-ui/cdk/tokens";import{tuiPure as f,tuiProvide as y}from"@taiga-ui/cdk/utils";import{Subject as C,delay as V,startWith as D,map as I,filter as b,distinctUntilChanged as T,switchMap as O,merge as w,EMPTY as S,identity as k}from"rxjs";class x{}function j(t){return{provide:x,useFactory:()=>r(t).valueTransformer}}class F extends x{fromControlValue(t){return this.prevValue=t,t}toControlValue(t){return this.prevValue=t??this.prevValue,this.prevValue}}const H=new class extends x{constructor(){super(...arguments),this.fromControlValue=k,this.toControlValue=k}},M={self:!0,optional:!0};class A{constructor(){this.fallback=r(g,M),this.refresh$=new C,this.pseudoInvalid=s(null),this.internal=s(this.fallback),this.control=r(u,{self:!0}),this.cdr=r(o),this.transformer=r(x,M),this.value=i((()=>this.internal()??this.fallback)),this.readOnly=s(!1),this.touched=s(!1),this.status=s(void 0),this.disabled=i((()=>"DISABLED"===this.status())),this.interactive=i((()=>!this.disabled()&&!this.readOnly())),this.invalid=i((()=>null!==this.pseudoInvalid()?!!this.pseudoInvalid()&&this.interactive():this.interactive()&&this.touched()&&"INVALID"===this.status())),this.mode=i((()=>this.readOnly()?"readonly":this.invalid()?"invalid":"valid")),this.onTouched=v,this.onChange=v,this.control.valueAccessor=this,this.refresh$.pipe(V(0),D(null),I((()=>this.control.control)),b(Boolean),T(),O((t=>w(t.valueChanges,t.statusChanges,t.events||S).pipe(D(null)))),p()).subscribe((()=>this.update()))}set readOnlySetter(t){this.readOnly.set(t)}set invalidSetter(t){this.pseudoInvalid.set(t)}registerOnChange(t){this.refresh$.next(),this.onChange=e=>{e!==this.internal()&&(t(this.toControlValue(e)),this.internal.set(e),this.update())}}registerOnTouched(t){this.onTouched=()=>{t(),this.update()}}setDisabledState(){this.update()}writeValue(t){const e=this.control instanceof m?this.control.model:t;this.internal.set(this.fromControlValue(e)),this.update()}fromControlValue(t){return this.transformer?this.transformer.fromControlValue(t):t}toControlValue(t){return this.transformer?this.transformer.toControlValue(t):t}update(){this.status.set(this.control.control?.status),this.touched.set(!!this.control.control?.touched),this.cdr.markForCheck()}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:A,deps:[],target:e.ɵɵFactoryTarget.Directive})}static{this.ɵdir=e.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:A,inputs:{readOnlySetter:["readOnly","readOnlySetter"],invalidSetter:["invalid","invalidSetter"]},ngImport:e})}}function E(t){return y(A,t)}t([f],A.prototype,"fromControlValue",null),t([f],A.prototype,"toControlValue",null),e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:A,decorators:[{type:n}],ctorParameters:function(){return[]},propDecorators:{readOnlySetter:[{type:a,args:["readOnly"]}],invalidSetter:[{type:a,args:["invalid"]}],fromControlValue:[],toControlValue:[]}});class P{constructor(){this.injector=r(l),this.nothing=r($).attach(this)}addComponentChild(t){const e=t.createInjector(this.injector),r=this.vcr.createComponent(t.component,{injector:e});return r.changeDetectorRef.detectChanges(),r}addTemplateChild(t,e){return this.vcr.createEmbeddedView(t,e)}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:P,deps:[],target:e.ɵɵFactoryTarget.Directive})}static{this.ɵdir=e.ɵɵngDeclareDirective({minVersion:"14.0.0",version:"16.2.12",type:P,viewQueries:[{propertyName:"vcr",first:!0,predicate:["viewContainer"],descendants:!0,read:c}],ngImport:e})}}e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:P,decorators:[{type:n}],propDecorators:{vcr:[{type:h,args:["viewContainer",{read:c}]}]}});class ${attach(t){this.host=t}add(t){return this.safeHost.addComponentChild(t)}remove({hostView:t}){this.removeTemplate(t)}addTemplate(t,e){return this.safeHost.addTemplateChild(t,e)}removeTemplate(t){t.destroyed||t.destroy()}get safeHost(){if(!this.host)throw new L;return this.host}static{this.ɵfac=e.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:$,deps:[],target:e.ɵɵFactoryTarget.Injectable})}static{this.ɵprov=e.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:$})}}function B(t){return y($,t)}e.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"16.2.12",ngImport:e,type:$,decorators:[{type:d}]});class L extends Error{constructor(){super(ngDevMode?"Portals cannot be used without TuiPortalHostComponent":"")}}class N{constructor(t,e={}){this.message=t,this.context=e}}export{H as TUI_IDENTITY_VALUE_TRANSFORMER,A as TuiControl,L as TuiNoHostException,F as TuiNonNullableValueTransformer,$ as TuiPortalService,P as TuiPortals,N as TuiValidationError,x as TuiValueTransformer,E as tuiAsControl,B as tuiAsPortal,j as tuiValueTransformerFrom};export default null;
